<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>t_cose: inc/t_cose/t_cose_key.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">t_cose
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="dir_c790dd4d93afe6413732f56f53ec2af4.html">t_cose</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">t_cose_key.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/q_useful_buf.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_common.h&quot;</code><br />
</div>
<p><a href="t__cose__key_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__key.html">t_cose_key</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad5ce7d43461bcf73114193741ee430c7" id="r_ad5ce7d43461bcf73114193741ee430c7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__key_8h.html#ad5ce7d43461bcf73114193741ee430c7">T_COSE_MAX_SYMMETRIC_KEY_LENGTH</a>&#160;&#160;&#160;32</td></tr>
<tr class="separator:ad5ce7d43461bcf73114193741ee430c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a82fbd8accf9a0e5fea4bd4f6640033b9" id="r_a82fbd8accf9a0e5fea4bd4f6640033b9"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__key_8h.html#a82fbd8accf9a0e5fea4bd4f6640033b9">t_cose_key_init_symmetric</a> (int32_t cose_algorithm_id, struct q_useful_buf_c symmetric_key, struct <a class="el" href="structt__cose__key.html">t_cose_key</a> *key)</td></tr>
<tr class="memdesc:a82fbd8accf9a0e5fea4bd4f6640033b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a <a class="el" href="structt__cose__key.html">t_cose_key</a> holding a symmetric key.  <br /></td></tr>
<tr class="separator:a82fbd8accf9a0e5fea4bd4f6640033b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04a1b530d44bc3d395820b950572ebb7" id="r_a04a1b530d44bc3d395820b950572ebb7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__key_8h.html#a04a1b530d44bc3d395820b950572ebb7">t_cose_key_free_symmetric</a> (struct <a class="el" href="structt__cose__key.html">t_cose_key</a> key)</td></tr>
<tr class="memdesc:a04a1b530d44bc3d395820b950572ebb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free <a class="el" href="structt__cose__key.html">t_cose_key</a> initialized by <a class="el" href="t__cose__key_8h.html#a82fbd8accf9a0e5fea4bd4f6640033b9" title="Initialize a t_cose_key holding a symmetric key.">t_cose_key_init_symmetric()</a>  <br /></td></tr>
<tr class="separator:a04a1b530d44bc3d395820b950572ebb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file has several purposes:</p>
<ul>
<li>The definition of struct <a class="el" href="structt__cose__key.html">t_cose_key</a>, an abstraction of a cryptographic key.</li>
<li>APIs to initialize struct <a class="el" href="structt__cose__key.html">t_cose_key</a> from common or standard key representations.</li>
<li>Encoding and decoding of COSE_Key defined in RFC 9052.</li>
</ul>
<p>t_cose is designed to support multiple cryptographic libraries. Cryptographic libraries have very different ways of holding and handling keys. It is not possible to have a common efficient representation of keys that is fully independent for all the cryptographic libraries. Struct <a class="el" href="structt__cose__key.html">t_cose_key</a> is an abstraction to hold several representations (pointers, handles and buffers) so key varying key representations can pass through t_cose to the library to the underlying library. This is the one part of t_cose APIs that is not independent of the cryptographic library.</p>
<p>For example, OpenSSL’s representation of a symmetric key is a pointer and a length. Mbed TLS’s representation is a key handle. Struct <a class="el" href="structt__cose__key.html">t_cose_key</a> is a union and can handle either of these, but the user needs to know which and act accordingly.</p>
<p>In typical use, the caller of t_cose will initialize a struct <a class="el" href="structt__cose__key.html">t_cose_key</a> with the right kind of key material for the operation. For example, when creating a COSE_Sign, they might initialize a <a class="el" href="structt__cose__key.html">t_cose_key</a> with a private key for ECDSA prime256v1. The steps to do this will be different for Mbed TLS from OpenSSL because these two libraries have very different representations for an EC key. Then the <a class="el" href="structt__cose__key.html">t_cose_key</a> is passed to a t_cose API which will pass it to the cryptographic libary for the particular cryptographic operation. t_cose itself does no operation with the key.</p>
<p><a class="el" href="structt__cose__key.html">t_cose_key</a> itself carries no type information. Any error checking for the key type is in the cryptographic library. For example, if you try to pass a symmetric key to a public key signing algorithm, t_cose won’t notice, but the cryptographic library probably will (such checking is left out of t_cose to keep code size and memory use lower). Sometimes the error numbers for these errors may be less than ideal because of the layers involved.</p>
<p>For some cryptographic libraries, keys involve some allocation that must be freed. This might be a memory pool (e.g., malloc) or a pool of key handles. While some do not require this, it is better practice to always free keys so that implementations are portable to both libraries that require freeing and those that don’t (libraries that don’t require freeing will provide a stub that does nothing for freeing).</p>
<p>Some libraries like Mbed TLS have mandatory key use policy and other like OpenSSL have none. Both are accommodated. COSE_Key also is able to express some key use policy.</p>
<p>When keys pass through t_cose completely, it is up to the caller to set up the policy of the key for the anticipated use. For example, when using Mbed TLS, a key that is passed to t_cose_signature_sign_main_set_signing_key() for ECDSA signing should be configured for use with the PSA_ALG_ECDSA(PSA_ALG_SHA_256) algorithm and the PSA_KEY_USAGE_SIGN_HASH usage.</p>
<p>The abstraction provided by <a class="el" href="structt__cose__key.html">t_cose_key</a> accommodates architectures where the actual bytes for the key are behind a protection boundary such as in an HSM. This support is an important design characteristic of t_cose.</p>
<p>When t_cose provides library-independent means to initialize a <a class="el" href="structt__cose__key.html">t_cose_key</a> such as <a class="el" href="t__cose__key_8h.html#a82fbd8accf9a0e5fea4bd4f6640033b9" title="Initialize a t_cose_key holding a symmetric key.">t_cose_key_init_symmetric()</a>, it will set up the policy as best it can in a general way. It will take the COSE algorithm ID and translate it to that for the library and set up for expected key usage.</p>
<p>Import/export for common/standard key serialization formats supported here are intentionally limited to those that can be more easily supported across all the cryptographic libraries to minimize the work of porting to a new cryptographic library. For example, symmetric keys are easy to support because they are always representable as a byte string. Public key formats are messier because there are multiple formats for representing them (e.g., PEM, DER, a point on a curve, …). COSE_Key is the primary serialization format that will be (is) supported here. This is a COSE library not a general purpose crypto library. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad5ce7d43461bcf73114193741ee430c7" name="ad5ce7d43461bcf73114193741ee430c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5ce7d43461bcf73114193741ee430c7">&#9670;&#160;</a></span>T_COSE_MAX_SYMMETRIC_KEY_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_MAX_SYMMETRIC_KEY_LENGTH&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the maximum key size for symmetric ciphers like AES and ChaCha20 (not supported yet). It also applies to key wrap. It is set to 32 to accommodate AES 256 and anything with a smaller key size. This is used to size buffers that hold keys and buffers that are related to key size. Attempts to use a symmetric cipher key size larger than this will result in an error. Smaller keys sizes are no problem.</p>
<p>This primarily affects stack use, but is not a primary consumer of stack. (Improvement: this could be made #ifdef conditional on which algorithms are enabled, but it's not a high priority because it doesn't use that much stack). </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a04a1b530d44bc3d395820b950572ebb7" name="a04a1b530d44bc3d395820b950572ebb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04a1b530d44bc3d395820b950572ebb7">&#9670;&#160;</a></span>t_cose_key_free_symmetric()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_key_free_symmetric </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a>&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free <a class="el" href="structt__cose__key.html">t_cose_key</a> initialized by <a class="el" href="t__cose__key_8h.html#a82fbd8accf9a0e5fea4bd4f6640033b9" title="Initialize a t_cose_key holding a symmetric key.">t_cose_key_init_symmetric()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>The key to free.</td></tr>
  </table>
  </dd>
</dl>
<p>While not all crypto libraries require this call to be made, it should be made by any code that is to be usable with multiple crypto libraries. </p>

</div>
</div>
<a id="a82fbd8accf9a0e5fea4bd4f6640033b9" name="a82fbd8accf9a0e5fea4bd4f6640033b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82fbd8accf9a0e5fea4bd4f6640033b9">&#9670;&#160;</a></span>t_cose_key_init_symmetric()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_key_init_symmetric </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>cose_algorithm_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>symmetric_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a> *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a <a class="el" href="structt__cose__key.html">t_cose_key</a> holding a symmetric key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_algorithm_id</td><td>The algorithm with which the key is to be used. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">symmetric_key</td><td>Pointer and length of bytes in symmertic key. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">key</td><td>The <a class="el" href="structt__cose__key.html">t_cose_key</a> to be initialize.</td></tr>
  </table>
  </dd>
</dl>
<p>This takes the bytes that make up a symmetric key and makes a <a class="el" href="structt__cose__key.html">t_cose_key</a> out of it in the form for use with the current crypto library. This works for keys for AES (e.g., ) key wrap and HMAC (e.g., ). For example, this can be used to make a <a class="el" href="structt__cose__key.html">t_cose_key</a> for t_cose_mac_set_computing_key(), t_cose_encrypt_set_key(), t_cose_recipient_enc_keywrap_set_key() and others APIs needing a symmetric key.</p>
<p>The lifetime of the bytes passed in for <code>symmetric_key</code> should be longer than that of the key returned as it may reference the bytes (It does for OpenSSL. Not sure for MbedTLS).</p>
<p>For some crypto libraries, the key will only be usable for the algorithm specfied. For other crypto libraries there no is policy enforcement.</p>
<p>The number of bits in <code>symmetric_key</code> should be the correct number for the algorithm specified. An error will usually be returned if it is not.</p>
<p>See <a class="el" href="t__cose__key_8h.html#a04a1b530d44bc3d395820b950572ebb7" title="Free t_cose_key initialized by t_cose_key_init_symmetric()">t_cose_key_free_symmetric()</a>.</p>
<p>See <a class="el" href="t__cose__key_8h.html#ad5ce7d43461bcf73114193741ee430c7">T_COSE_MAX_SYMMETRIC_KEY_LENGTH</a>. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
