<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>t_cose: inc/t_cose/t_cose_recipient_enc_esdh.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">t_cose
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="dir_c790dd4d93afe6413732f56f53ec2af4.html">t_cose</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">t_cose_recipient_enc_esdh.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>ECDH Recipient Encrypt for COSE_Encrypt Messages.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="t__cose__parameters_8h_source.html">t_cose/t_cose_parameters.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__common_8h_source.html">t_cose/t_cose_common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__key_8h_source.html">t_cose/t_cose_key.h</a>&quot;</code><br />
</div>
<p><a href="t__cose__recipient__enc__esdh_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a07194740fe2bb03e55afa2b9f29bb697" id="r_a07194740fe2bb03e55afa2b9f29bb697"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#a07194740fe2bb03e55afa2b9f29bb697">T_COSE_ENC_COSE_KDF_CONTEXT_SIZE</a>&#160;&#160;&#160;50</td></tr>
<tr class="separator:a07194740fe2bb03e55afa2b9f29bb697"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adbffda7deb635d52b98c34c3c54b6a23" id="r_adbffda7deb635d52b98c34c3c54b6a23"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#adbffda7deb635d52b98c34c3c54b6a23">t_cose_recipient_enc_esdh_init</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, int32_t cose_algorithm_id, int32_t cose_ec_curve_id)</td></tr>
<tr class="memdesc:adbffda7deb635d52b98c34c3c54b6a23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the creator COSE_Recipient for ESDH content key distribution.  <br /></td></tr>
<tr class="separator:adbffda7deb635d52b98c34c3c54b6a23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef511452e19312df6cca5881942c215c" id="r_aef511452e19312df6cca5881942c215c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#aef511452e19312df6cca5881942c215c">t_cose_recipient_enc_esdh_set_key</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, struct <a class="el" href="structt__cose__key.html">t_cose_key</a> recipient, struct q_useful_buf_c kid)</td></tr>
<tr class="memdesc:aef511452e19312df6cca5881942c215c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the recipient key, pkR.  <br /></td></tr>
<tr class="separator:aef511452e19312df6cca5881942c215c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbee7e1f2522f48e055ffa8b92076477" id="r_afbee7e1f2522f48e055ffa8b92076477"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#afbee7e1f2522f48e055ffa8b92076477">t_cose_recipient_enc_esdh_supp_info</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, const struct q_useful_buf_c supp_pub_other, const struct q_useful_buf_c supp_priv_info)</td></tr>
<tr class="memdesc:afbee7e1f2522f48e055ffa8b92076477"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set supplimentary items in the KDF context info struct.  <br /></td></tr>
<tr class="separator:afbee7e1f2522f48e055ffa8b92076477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a957dd0fbdf908aaa21df212b670c7471" id="r_a957dd0fbdf908aaa21df212b670c7471"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#a957dd0fbdf908aaa21df212b670c7471">t_cose_recipient_enc_esdh_party_info</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, const struct q_useful_buf_c party_u_ident, const struct q_useful_buf_c party_v_ident, const bool do_not_send)</td></tr>
<tr class="memdesc:a957dd0fbdf908aaa21df212b670c7471"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set PartyU and PartyV identity for KDF context info struct.  <br /></td></tr>
<tr class="separator:a957dd0fbdf908aaa21df212b670c7471"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6aaa6226dfed81622581ae4ea7082f9" id="r_ac6aaa6226dfed81622581ae4ea7082f9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#ac6aaa6226dfed81622581ae4ea7082f9">t_cose_recipient_enc_esdh_salt</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, const bool use_salt, const struct q_useful_buf_c salt_bytes)</td></tr>
<tr class="memdesc:ac6aaa6226dfed81622581ae4ea7082f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure salt in KDF Context.  <br /></td></tr>
<tr class="separator:ac6aaa6226dfed81622581ae4ea7082f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5feeb247897468cccd880c2e6958dab4" id="r_a5feeb247897468cccd880c2e6958dab4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__recipient__enc__esdh_8h.html#a5feeb247897468cccd880c2e6958dab4">t_cose_recipient_enc_esdh_kdf_buf</a> (struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *context, struct q_useful_buf kdf_buffer)</td></tr>
<tr class="memdesc:a5feeb247897468cccd880c2e6958dab4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure a larger buffer to serialize the COSE_KDF_Context.  <br /></td></tr>
<tr class="separator:a5feeb247897468cccd880c2e6958dab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adce87f3a81f330f37f5c3bc1eed83763" id="r_adce87f3a81f330f37f5c3bc1eed83763"><td class="memItemLeft" align="right" valign="top"><a id="adce87f3a81f330f37f5c3bc1eed83763" name="adce87f3a81f330f37f5c3bc1eed83763"></a>
enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>t_cose_recipient_create_esdh_cb_private</b> (struct <a class="el" href="structt__cose__recipient__enc.html">t_cose_recipient_enc</a> *me_x, struct q_useful_buf_c cek, const struct <a class="el" href="structt__cose__alg__and__bits.html">t_cose_alg_and_bits</a> ce_alg, QCBOREncodeContext *cbor_encoder)</td></tr>
<tr class="separator:adce87f3a81f330f37f5c3bc1eed83763"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ECDH Recipient Encrypt for COSE_Encrypt Messages. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a07194740fe2bb03e55afa2b9f29bb697" name="a07194740fe2bb03e55afa2b9f29bb697"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07194740fe2bb03e55afa2b9f29bb697">&#9670;&#160;</a></span>T_COSE_ENC_COSE_KDF_CONTEXT_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_ENC_COSE_KDF_CONTEXT_SIZE&#160;&#160;&#160;50</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The default size of the COSE_KDF_Context. See <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a5feeb247897468cccd880c2e6958dab4" title="Configure a larger buffer to serialize the COSE_KDF_Context.">t_cose_recipient_enc_esdh_kdf_buf()</a> and T_COSE_ERR_KDF_BUFFER_TOO_SMALL. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adbffda7deb635d52b98c34c3c54b6a23" name="adbffda7deb635d52b98c34c3c54b6a23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbffda7deb635d52b98c34c3c54b6a23">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>cose_algorithm_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>cose_ec_curve_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the creator COSE_Recipient for ESDH content key distribution. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_algorithm_id</td><td>The content key distribution algorithm ID. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_ec_curve_id</td><td>The curve ID.</td></tr>
  </table>
  </dd>
</dl>
<p>This must be called not only to set the keywrap id, the content key distribution (ckd) id, and the curve id, but also because this sets up the recipient callbacks. That is when all the real work of content key distribution gets done.</p>
<p>If unknown algorithm IDs are passed, an error will occur when <a class="el" href="structt__cose__encrypt__enc.html">t_cose_encrypt_enc()</a> is called and the error code will be returned there. </p>

</div>
</div>
<a id="a5feeb247897468cccd880c2e6958dab4" name="a5feeb247897468cccd880c2e6958dab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5feeb247897468cccd880c2e6958dab4">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_kdf_buf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_kdf_buf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>kdf_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure a larger buffer to serialize the COSE_KDF_Context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>ESDH encryption context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kdf_buffer</td><td>The buffer used to serialize the COSE_KDF_Context.</td></tr>
  </table>
  </dd>
</dl>
<p>For most use, the internal buffer for the COSE_KDF_Context is large enough. The internal buffer size is <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a07194740fe2bb03e55afa2b9f29bb697">T_COSE_ENC_COSE_KDF_CONTEXT_SIZE</a>.</p>
<p>The <code>COSE_KDF_Context</code> described RFC 9053 section 5.3 must fit in this buffer. With no additional context items provided the serialized internal KDF context is about 20 bytes including the protected headers for the algorithm ID. If additional protected headers are added with TODO, PartyU or PartyV are added with <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a957dd0fbdf908aaa21df212b670c7471" title="Set PartyU and PartyV identity for KDF context info struct.">t_cose_recipient_enc_esdh_party_info()</a> or suppplemental info is added with <a class="el" href="t__cose__recipient__enc__esdh_8h.html#afbee7e1f2522f48e055ffa8b92076477" title="Set supplimentary items in the KDF context info struct.">t_cose_recipient_enc_esdh_supp_info()</a>, it may be necessary to call this with a buffer larger than <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a07194740fe2bb03e55afa2b9f29bb697">T_COSE_ENC_COSE_KDF_CONTEXT_SIZE</a>.</p>
<p>T_COSE_ERR_KDF_BUFFER_TOO_SMALL will be returned from <a class="el" href="structt__cose__encrypt__enc.html">t_cose_encrypt_enc()</a> or <a class="el" href="t__cose__encrypt__enc_8h.html#a8d211229ffe582a97d1a003ea67b6511" title="Create a COSE_Encrypt or COSE_Encrypt0 structure and encrypt the provided plaintext.">t_cose_encrypt_enc_detached()</a> if the buffer is too small. </p>

</div>
</div>
<a id="a957dd0fbdf908aaa21df212b670c7471" name="a957dd0fbdf908aaa21df212b670c7471"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a957dd0fbdf908aaa21df212b670c7471">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_party_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_party_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>party_u_ident</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>party_v_ident</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>do_not_send</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set PartyU and PartyV identity for KDF context info struct. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>ESDH encryption context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">party_u_ident</td><td>String for PartyU or NULL_Q_USEFUL_BUF_C. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">party_v_ident</td><td>String for PartyV or NULL_Q_USEFUL_BUF_C. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">do_not_send</td><td>True indicates these should be left out of the COSE header parameters, that they should not be sent to the recipient.</td></tr>
  </table>
  </dd>
</dl>
<p>Like the documentation for <a class="el" href="t__cose__recipient__enc__esdh_8h.html#afbee7e1f2522f48e055ffa8b92076477" title="Set supplimentary items in the KDF context info struct.">t_cose_recipient_enc_esdh_supp_info()</a> this gives and opinion and recommendation: PartyU and PartyV should be left unset and unused. Don't call this method.</p>
<p>The point of PartyU and PartyV is to bind the content encryption key to the sender and receiver context. These are in COSE because they are in NIST SP800-56A and JOSE. They are justified by academic papers on attacks on key agreement protocols found in Appendix B of NIST SP800-56A. Probably these attacks don't apply because you probably are using a good RNG and because the ephemeral key is generated anew for every encryption. Good RNGs are much more common now (2023) than when these papers were authored.</p>
<p>These data items are described in RFC 9053 section 5.2. This API only allows setting Party*.identity. It doesn't allow setting Party*.nonce or Party*.other. It always sets them to <code>NULL</code>. Speaking with opinion, 'nonce' and 'other' seem very unnecessary and complex. Hopefully, no implementation ever uses them. Everything needed can be done with the 'PartyInfo*.idenity' data items.</p>
<p>See <a class="el" href="t__cose__recipient__enc__esdh_8h.html#afbee7e1f2522f48e055ffa8b92076477" title="Set supplimentary items in the KDF context info struct.">t_cose_recipient_enc_esdh_supp_info()</a> where it is recommended to set one of the KDF context inputs and additionally <a class="el" href="t__cose__recipient__enc__esdh_8h.html#ac6aaa6226dfed81622581ae4ea7082f9" title="Configure salt in KDF Context.">t_cose_recipient_enc_esdh_salt()</a>.</p>
<p>The opinions here were formed from discussions with long-time workers on COSE, CMS, LAMPS, reading of NIST SP800-56A and trying to formulate attacks that these data items defend against.</p>
<p>Now on to non-opinion mechanics of this API.</p>
<p>If these data items are not set, then PartyInfo*.identity will be <code>NULL</code> when the KDF Context Information Structure is created. Otherwise, they will be the values set here. If they are set to <code>NULL_Q_USEFUL_C</code> here, they will also be <code>NULL</code> in the input to the KDF. PartyInfo*.nonce and PartyInfo*.other are always \ cNULL in this implementation. It is not possible to set them.</p>
<p>If these are set to non-NULL values, they will be sent in unprotected headers, unless <code>do_not_send</code> is <code>true</code>.</p>
<p>If these are set to long strings, then <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a5feeb247897468cccd880c2e6958dab4" title="Configure a larger buffer to serialize the COSE_KDF_Context.">t_cose_recipient_enc_esdh_kdf_buf()</a> may have to be called to supply a buffer larger than <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a07194740fe2bb03e55afa2b9f29bb697">T_COSE_ENC_COSE_KDF_CONTEXT_SIZE</a> for the internal KDF Context construction. </p>

</div>
</div>
<a id="ac6aaa6226dfed81622581ae4ea7082f9" name="ac6aaa6226dfed81622581ae4ea7082f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6aaa6226dfed81622581ae4ea7082f9">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_salt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_salt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>use_salt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>salt_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure salt in KDF Context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>ESDH encryption context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_salt</td><td>Set to <code>true</code> to enable, <code>false</code> to disable </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">salt_bytes</td><td>Bytes for the salt or NULL_Q_USEFUL_BUF_C for an internally generated random salt.</td></tr>
  </table>
  </dd>
</dl>
<p>By default no salt is input to the KDF context. It is usually not used or needed.</p>
<p>If <code>use_salt</code> is true and <code>salt_bytes</code> is <code>NULL_Q_USEFUL_BUF_C</code>, the RNG will be used to make a salt of the same size that the KDF is requested to output. If <code>use_salt</code> is true and <code>salt_bytes</code> are not <code>NULL_Q_USEFUL_BUF_C</code>, those bytes will be used as the salt. In either case the salt will always be sent in the unprotected headers. If the <code>use_salt</code> is false, no salt will be used in the KDF context and no salt will be sent.</p>
<p>Most use case do not need the salt. See discussion in RFC 5869 and NIST SP 800 56 for reasons for sending or not sending a salt. The purpose of the salt is to provide extra randomness in the KDF context. This is often unnecessary because the ephemeral key is randomly generated anew for every encryption. Note that t_cose assumes integration with a good quality random number generator as sufficient security is unlikely without one.</p>
<p>Note that if the salt is used, then the receiver must be able to process a salt. If not, the KDF will produce an incorrect result, and the decryption will fail with the T_COSE_ERR_DATA_AUTH_FAILED error. The t_cose ECDH decrypt implementation, <a class="el" href="structt__cose__recipient__dec__esdh.html">t_cose_recipient_dec_esdh</a>, will decode the salt header parameter and use it automatically with no configuration on the decryption side. Other COSE implementations may or may not decode and/or process the salt. </p>

</div>
</div>
<a id="aef511452e19312df6cca5881942c215c" name="aef511452e19312df6cca5881942c215c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef511452e19312df6cca5881942c215c">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_set_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_set_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a>&#160;</td>
          <td class="paramname"><em>recipient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>kid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets the recipient key, pkR. </p>
<p>The kid is optional and can be NULL </p>

</div>
</div>
<a id="afbee7e1f2522f48e055ffa8b92076477" name="afbee7e1f2522f48e055ffa8b92076477"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbee7e1f2522f48e055ffa8b92076477">&#9670;&#160;</a></span>t_cose_recipient_enc_esdh_supp_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_recipient_enc_esdh_supp_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__recipient__enc__esdh.html">t_cose_recipient_enc_esdh</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>supp_pub_other</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>supp_priv_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set supplimentary items in the KDF context info struct. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>ESDH encryption context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">supp_pub_other</td><td>Supplemental public info other or <code>NULL_Q_USEFUL_BUF_C</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">supp_priv_info</td><td>Supplemental private info other or <code>NULL_Q_USEFUL_BUF_C</code> </td></tr>
  </table>
  </dd>
</dl>
<p>It is not so easy to figure out how to use the required COSE KDF context in RFC 9053, section 5, so this starts out with an opinion and recommendation. If you are just getting started playing with COSE encryption, set everything to NULL (all of PartyU/V, all supp items). Everything in the COSE WG Examples repository is like this. This is easily accomplished in t_cose by not doing anything. (Note that the algorithm ID and size and the protected headers in the context structure can't be NULL, but they are filled in automatically by t_cose).</p>
<p>If you are moving beyond getting started to define a new use case for COSE, set <code>supp_pub_other</code> to a fixed string naming your use case. For example, "Xxxx Firmware Encryption". This is not the name of the application implementing the use case, but the broad name of the COSE use case. All applications for the use case must hard code the same string. Everything else can by <code>NULL</code>.</p>
<p>Note that the receiver of a COSE message must have the same KDF context set up. If not, the intermediate derived keys will not be the same and the decrypt will return T_COSE_ERR_DATA_AUTH_FAILED.</p>
<p>See RFC 9053 section 5.2 for more background and also NIST SP 800 56 and references in it for rationale for the existence of all the facets of the KDF Context.</p>
<p>See <a class="el" href="t__cose__recipient__enc__esdh_8h.html#a957dd0fbdf908aaa21df212b670c7471" title="Set PartyU and PartyV identity for KDF context info struct.">t_cose_recipient_enc_esdh_party_info()</a> and <a class="el" href="t__cose__recipient__enc__esdh_8h.html#ac6aaa6226dfed81622581ae4ea7082f9" title="Configure salt in KDF Context.">t_cose_recipient_enc_esdh_salt()</a> for related discussion.</p>
<p>This recommendation of minimum use of the KDF context is made based on discussion with long-time experts in COSE, CMS, LAMPS and other. An important justification is that the ephemeral key is always generated anew from a high-quality random number generator for each encrypted message.</p>
<p>Now on to the mechanics of this API.</p>
<p>This sets the "SuppPubInfo.other" field of PartyInfo as described in RFC 9053. This is optional and will be <code>NULL</code> if not set. If this is set, it will be sent to the recipient in a header parameter. Don't call this or pass <code>NULL_USEFUL_BUF_C</code> to not set this.</p>
<p>This can also set the "SuppPrivInfo" field in PartyInfo. This is optional. It is never sent in a header parameter since it is private information. Somehow the recipient must also have and set this during decryption. Don't call this or pass <code>NULL_USEFUL_BUF_C</code> to not set SuppPrivInfo. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
