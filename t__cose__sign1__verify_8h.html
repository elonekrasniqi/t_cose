<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>t_cose: inc/t_cose/t_cose_sign1_verify.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">t_cose
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="dir_c790dd4d93afe6413732f56f53ec2af4.html">t_cose</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">t_cose_sign1_verify.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Verify a COSE_Sign1 Message.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/q_useful_buf.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_common.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_parameters.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/QCBOR/inc/qcbor/qcbor_common.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_sign_verify.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_signature_verify_main.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_signature_verify_eddsa.h&quot;</code><br />
</div>
<p><a href="t__cose__sign1__verify_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adab625509c35954fd2f35ad0a32ddfa6" id="r_adab625509c35954fd2f35ad0a32ddfa6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#adab625509c35954fd2f35ad0a32ddfa6">t_cose_sign1_verify_init</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, uint32_t option_flags)</td></tr>
<tr class="memdesc:adab625509c35954fd2f35ad0a32ddfa6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize for <code>COSE_Sign1</code> message verification.  <br /></td></tr>
<tr class="separator:adab625509c35954fd2f35ad0a32ddfa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9e7474bf4b308c90f8f3ce8931c6a1a" id="r_af9e7474bf4b308c90f8f3ce8931c6a1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a">t_cose_sign1_set_verification_key</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct <a class="el" href="structt__cose__key.html">t_cose_key</a> verification_key)</td></tr>
<tr class="memdesc:af9e7474bf4b308c90f8f3ce8931c6a1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set key for <code>COSE_Sign1</code> message verification.  <br /></td></tr>
<tr class="separator:af9e7474bf4b308c90f8f3ce8931c6a1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5e954dddff8f2d6671b90393bf58a35" id="r_ae5e954dddff8f2d6671b90393bf58a35"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ae5e954dddff8f2d6671b90393bf58a35">t_cose_sign1_verify_set_auxiliary_buffer</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf auxiliary_buffer)</td></tr>
<tr class="memdesc:ae5e954dddff8f2d6671b90393bf58a35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure a buffer used to serialize the Sig_Structure.  <br /></td></tr>
<tr class="separator:ae5e954dddff8f2d6671b90393bf58a35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a3b69b76f045df2797693e89b08d484" id="r_a3a3b69b76f045df2797693e89b08d484"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a3a3b69b76f045df2797693e89b08d484">t_cose_sign1_verify_auxiliary_buffer_size</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context)</td></tr>
<tr class="memdesc:a3a3b69b76f045df2797693e89b08d484"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the required auxiliary buffer size for the most recent verification operation.  <br /></td></tr>
<tr class="separator:a3a3b69b76f045df2797693e89b08d484"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14a59bbe3e640de21ea4f8e34abf3c9" id="r_ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c sign1, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a <code>COSE_Sign1</code>.  <br /></td></tr>
<tr class="separator:ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d952700e4dd22eb650b5c376c02b4c1" id="r_a0d952700e4dd22eb650b5c376c02b4c1"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a0d952700e4dd22eb650b5c376c02b4c1">t_cose_sign1_verify_aad</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c sign1, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:a0d952700e4dd22eb650b5c376c02b4c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a COSE_Sign1 with Additional Authenticated Data.  <br /></td></tr>
<tr class="separator:a0d952700e4dd22eb650b5c376c02b4c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b834d44db6a424c542619f6590bbea8" id="r_a6b834d44db6a424c542619f6590bbea8"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a6b834d44db6a424c542619f6590bbea8">t_cose_sign1_verify_detached</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c cose_message, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c detached_payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:a6b834d44db6a424c542619f6590bbea8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a COSE_Sign1 with detached payload.  <br /></td></tr>
<tr class="separator:a6b834d44db6a424c542619f6590bbea8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be686d6c16bb92cf6b99c9630f47d07" id="r_a8be686d6c16bb92cf6b99c9630f47d07"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a8be686d6c16bb92cf6b99c9630f47d07">t_cose_sign1_get_nth_tag</a> (const struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, size_t n)</td></tr>
<tr class="memdesc:a8be686d6c16bb92cf6b99c9630f47d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return unprocessed tags from most recent signature verify.  <br /></td></tr>
<tr class="separator:a8be686d6c16bb92cf6b99c9630f47d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5881c81d0ef4aa70d6337c1272be4a2" id="r_ab5881c81d0ef4aa70d6337c1272be4a2"><td class="memItemLeft" align="right" valign="top"><a id="ab5881c81d0ef4aa70d6337c1272be4a2" name="ab5881c81d0ef4aa70d6337c1272be4a2"></a>
enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>t_cose_sign1_private_verify_main</b> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *me, struct q_useful_buf_c cose_message, struct q_useful_buf_c ext_sup_data, bool payload_is_detached, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="separator:ab5881c81d0ef4aa70d6337c1272be4a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Verify a COSE_Sign1 Message. </p>
<p>This verifies a <code>COSE_Sign1</code> message in compliance with [COSE (RFC 8152)] (<a href="https://tools.ietf.org/html/rfc8152">https://tools.ietf.org/html/rfc8152</a>). A <code>COSE_Sign1</code> message is a CBOR encoded binary blob that contains header parameters, a payload and a signature. Usually the signature is made with an EC signing algorithm like ECDSA.</p>
<p>This implementation is intended to be small and portable to different OS's and platforms. Its dependencies are:</p><ul>
<li><a href="https://github.com/laurencelundblade/QCBOR">QCBOR</a></li>
<li>&lt;stdint.h&gt;, &lt;string.h&gt;, &lt;stddef.h&gt;</li>
<li>Hash functions like SHA-256</li>
<li>Signing functions like ECDSA</li>
</ul>
<p>There is a cryptographic adaptation layer defined in t_cose_crypto.h. An implementation can be made of the functions in it for different cryptographic libraries. This means that different integrations with different cryptographic libraries may support only signing with a particular set of algorithms. Integration with <a href="https://www.openssl.org">OpenSSL</a> is supported. Key ID look up also varies by different cryptographic library integrations.</p>
<p>See <a class="el" href="t__cose__common_8h.html" title="This file contains definitions common to all public t_cose interfaces.">t_cose_common.h</a> for preprocessor defines to reduce object code and stack use by disabling features. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8be686d6c16bb92cf6b99c9630f47d07" name="a8be686d6c16bb92cf6b99c9630f47d07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be686d6c16bb92cf6b99c9630f47d07">&#9670;&#160;</a></span>t_cose_sign1_get_nth_tag()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t t_cose_sign1_get_nth_tag </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return unprocessed tags from most recent signature verify. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Index of the tag to return.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The tag value or CBOR_TAG_INVALID64 if there is no tag at the index or the index is too large.</dd></dl>
<p>The 0th tag is the one for which the COSE message is the content. Loop from 0 up until CBOR_TAG_INVALID64 is returned. The maximum is <a class="el" href="t__cose__common_8h.html#a7a0e083f1728e5e46fc28d913e771b4a">T_COSE_MAX_TAGS_TO_RETURN</a>.</p>
<p>It will be necessary to call this for a general implementation of a CWT since sometimes the CWT tag is required. This is also needed for recursive processing of nested COSE signing and/or encryption. </p>

</div>
</div>
<a id="af9e7474bf4b308c90f8f3ce8931c6a1a" name="af9e7474bf4b308c90f8f3ce8931c6a1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9e7474bf4b308c90f8f3ce8931c6a1a">&#9670;&#160;</a></span>t_cose_sign1_set_verification_key()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_set_verification_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a>&#160;</td>
          <td class="paramname"><em>verification_key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set key for <code>COSE_Sign1</code> message verification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">verification_key</td><td>The verification key to use.</td></tr>
  </table>
  </dd>
</dl>
<p>There are four ways that the verification key is found and supplied to t_cose so that <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> succeeds.</p>
<ol type="1">
<li>Look up by kid parameter and set by <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a></li>
<li>Look up by other and set by <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a></li>
<li>Determination by kid that short circuit signing is used (test only)</li>
<li>Look up by kid parameter in cryptographic adaptation layer</li>
</ol>
<p>Note that there is no means where certificates, like X.509 certificates, are provided in the COSE parameters. Perhaps there will be in the future but that is not in common use or supported by this implementation.</p>
<p>To use 1, it is necessary to call <a class="el" href="t__cose__sign1__verify_8h.html#adab625509c35954fd2f35ad0a32ddfa6" title="Initialize for COSE_Sign1 message verification.">t_cose_sign1_verify_init()</a> and <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> twice. The first time <a class="el" href="t__cose__sign1__verify_8h.html#adab625509c35954fd2f35ad0a32ddfa6" title="Initialize for COSE_Sign1 message verification.">t_cose_sign1_verify_init()</a> is called, give the <a class="el" href="t__cose__common_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option. Then call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> and the kid will be returned in <code>parameters</code>. The caller finds the kid on their own. Then call this to set the key. Last call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>, again without the <a class="el" href="t__cose__common_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option.</p>
<p>To use 2, the key is somehow determined without the kid and <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> is called with it. Then <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> is called. Note that this implementation cannot return non-standard header parameters, at least not yet.</p>
<p>To use 3, initialize with T_COSE_OPT_ALLOW_SHORT_CIRCUIT. No call to <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> is necessary. If you do call <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a>, the kid for short circuit signing will be recognized and the set key will be ignored.</p>
<p>To use 4, first be sure that the cryptographic adapter supports look up by kid. There's no API to determine this, so it is probably determined by other system documentation (aka source code). In this mode, all that is necessary is to call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>.</p>
<p>3 always works no matter what is done in the cryptographic adaptation layer because it never calls out to it. The OpenSSL adaptor supports 1 and 2. </p>

</div>
</div>
<a id="ab14a59bbe3e640de21ea4f8e34abf3c9" name="ab14a59bbe3e640de21ea4f8e34abf3c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab14a59bbe3e640de21ea4f8e34abf3c9">&#9670;&#160;</a></span>t_cose_sign1_verify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a <code>COSE_Sign1</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>See <a class="el" href="t__cose__sign1__verify_8h.html#af9e7474bf4b308c90f8f3ce8931c6a1a" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> for discussion on where the verification key comes from.</p>
<p>Verification involves the following steps.</p>
<ul>
<li>The CBOR-format <code>COSE_Sign1</code> structure is parsed. This makes sure <code>COSE_Sign1</code> is valid CBOR and follows the required structure for <code>COSE_Sign1</code>.</li>
<li>The protected header parameters are decoded, particular the algorithm id.</li>
<li>The unprotected headers parameters are decoded, particularly the kid.</li>
<li>The payload is identified. The internals of the payload are not decoded.</li>
<li>The expected hash, the "to-be-signed" bytes are computed. The hash algorithm used comes from the signing algorithm. If the algorithm is unknown or not supported this will error out.</li>
<li>Finally, the signature verification is performed.</li>
</ul>
<p>If verification is successful, the pointer to the CBOR-encoded payload is returned. The parameters are returned if requested. All pointers returned are to memory in the <code>sign1</code> passed in.</p>
<p>Note that this only handles standard COSE header parameters. There are no facilities for custom header parameters, even though they are allowed by the COSE standard.</p>
<p>This will recognize the special key ID for short-circuit signing and verify it if the T_COSE_OPT_ALLOW_SHORT_CIRCUIT is set.</p>
<p>Indefinite length CBOR strings are not supported by this implementation. <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a3b506bca4791f5bdeeb46a84d13098a6">T_COSE_ERR_SIGN1_FORMAT</a> will be returned if they are in the input <code>COSE_Sign1</code> messages. For example, if the payload is an indefinite-length byte string, this error will be returned. </p>

</div>
</div>
<a id="a0d952700e4dd22eb650b5c376c02b4c1" name="a0d952700e4dd22eb650b5c376c02b4c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d952700e4dd22eb650b5c376c02b4c1">&#9670;&#160;</a></span>t_cose_sign1_verify_aad()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify_aad </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a COSE_Sign1 with Additional Authenticated Data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This is just like <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>, but allows passing externally supplied data (fomerly referred to as "AAD") for verification.</p>
<p>Externally supplied data is some additional bytes that are covered by the signature in addition to the payload. They may be any bytes, but are often some options or commands that are sent along with the <code>COSE_Sign1</code>. If a <code>COSE_Sign1</code> was created with externally supplied data, that data must be passed in here to successfully verify the signature. If it is not, a <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a5629e71ec5fce4c867421b014481fb22">T_COSE_ERR_SIG_VERIFY</a> will occur. There is no indication in the <code>COSE_Sign1</code> to know whether there was externally supplied data input when it was created. It has to be known by context.</p>
<p>Calling this with <code>ext_sup_data</code> as <code>NULL_Q_USEFUL_BUF_C</code> is the same as calling <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>. </p>

</div>
</div>
<a id="a3a3b69b76f045df2797693e89b08d484" name="a3a3b69b76f045df2797693e89b08d484"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a3b69b76f045df2797693e89b08d484">&#9670;&#160;</a></span>t_cose_sign1_verify_auxiliary_buffer_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t t_cose_sign1_verify_auxiliary_buffer_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the required auxiliary buffer size for the most recent verification operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes of auxiliary buffer used by the most recent verification operation.</dd></dl>
<p>This function can be called after <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (or equivalent) was called. If the context was initialized with the DECODE_ONLY flag, it returns the number of bytes that would have been used by the signing operation. This allows the caller to allocate an appropriately sized buffer before performing the actual verification.</p>
<p>This function returns zero if the signature algorithm used does not need an auxiliary buffer. </p>

</div>
</div>
<a id="a6b834d44db6a424c542619f6590bbea8" name="a6b834d44db6a424c542619f6590bbea8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b834d44db6a424c542619f6590bbea8">&#9670;&#160;</a></span>t_cose_sign1_verify_detached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify_detached </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>cose_message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>detached_payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a COSE_Sign1 with detached payload. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detached_payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>A detached payload is one that is not inside the <code>COSE_Sign1</code>, but is conveyed separately. It is still covered by the signature exactly as if it was the payload inside the <code>COSE_Sign1</code>.</p>
<p>This function is the same as <a class="el" href="t__cose__sign1__verify_8h.html#a0d952700e4dd22eb650b5c376c02b4c1" title="Verify a COSE_Sign1 with Additional Authenticated Data.">t_cose_sign1_verify_aad()</a>, but for use with a detached payload. Instead of the payload being returned, it must be passed in as it must have arrived separately from the <code>COSE_Sign1</code>. The signature covers it so it must be passed in to complete the verification.</p>
<p><code>ext_sup_data</code> may be <code>NULL_Q_USEFUL_BUF_C</code> if there is none. </p>

</div>
</div>
<a id="adab625509c35954fd2f35ad0a32ddfa6" name="adab625509c35954fd2f35ad0a32ddfa6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adab625509c35954fd2f35ad0a32ddfa6">&#9670;&#160;</a></span>t_cose_sign1_verify_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_verify_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>option_flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize for <code>COSE_Sign1</code> message verification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The context to initialize. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">option_flags</td><td>Options controlling the verification.</td></tr>
  </table>
  </dd>
</dl>
<p>This must be called before using the verification context. </p>

</div>
</div>
<a id="ae5e954dddff8f2d6671b90393bf58a35" name="ae5e954dddff8f2d6671b90393bf58a35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5e954dddff8f2d6671b90393bf58a35">&#9670;&#160;</a></span>t_cose_sign1_verify_set_auxiliary_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_sign1_verify_set_auxiliary_buffer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>auxiliary_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure a buffer used to serialize the Sig_Structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">auxiliary_buffer</td><td>The auxiliary buffer to be used.</td></tr>
  </table>
  </dd>
</dl>
<p>Some signature algorithms (namely EdDSA), require two passes over their input. In order to achieve this, the library needs to serialize a temporary to-be-signed structure into an auxiliary buffer. This function allows the user to configure such a buffer.</p>
<p>The buffer must be big enough to accomodate the Sig_Structure type, which is roughly the sum of sizes of the encoded protected parameters, externally supplied data and payload, along with a few dozen bytes of overhead.</p>
<p>To compute the exact size needed, initialize the context with the <a class="el" href="t__cose__common_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option, and call the <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (or similar). After the message decoding, the necessary auxiliary buffer size is available by calling <a class="el" href="t__cose__sign1__verify_8h.html#a3a3b69b76f045df2797693e89b08d484">t_cose_sign1_verify_auxiliary_buffer_size</a>. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
