<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>t_cose: inc/t_cose/t_cose_sign1_sign.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">t_cose
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="dir_c790dd4d93afe6413732f56f53ec2af4.html">t_cose</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">t_cose_sign1_sign.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Create a <code>COSE_Sign1</code> message, such as for EAT or CWT Token.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;C:/Users/ADMIN/QCBOR/inc/qcbor/qcbor.h&quot;</code><br />
<code>#include &quot;<a class="el" href="q__useful__buf_8h_source.html">q_useful_buf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__common_8h_source.html">t_cose_common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__sign__sign_8h_source.html">t_cose_sign_sign.h</a>&quot;</code><br />
<code>#include &quot;t_cose_signature_sign_main.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_signature_sign_eddsa.h&quot;</code><br />
<code>#include &quot;C:/Users/ADMIN/t_cose/inc/t_cose/t_cose_parameters.h&quot;</code><br />
</div>
<p><a href="t__cose__sign1__sign_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8927bb39bae2bb95d3a94e034fb2b691" id="r_a8927bb39bae2bb95d3a94e034fb2b691"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a8927bb39bae2bb95d3a94e034fb2b691">t_cose_sign1_sign_init</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, uint32_t option_flags, int32_t cose_algorithm_id)</td></tr>
<tr class="memdesc:a8927bb39bae2bb95d3a94e034fb2b691"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize to start creating a <code>COSE_Sign1</code>.  <br /></td></tr>
<tr class="separator:a8927bb39bae2bb95d3a94e034fb2b691"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e155e4383f1f89551dffd23e2654b90" id="r_a6e155e4383f1f89551dffd23e2654b90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a6e155e4383f1f89551dffd23e2654b90">t_cose_sign1_set_signing_key</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct <a class="el" href="structt__cose__key.html">t_cose_key</a> signing_key, struct q_useful_buf_c kid)</td></tr>
<tr class="memdesc:a6e155e4383f1f89551dffd23e2654b90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the key and kid (key ID) for signing.  <br /></td></tr>
<tr class="separator:a6e155e4383f1f89551dffd23e2654b90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a427a709f9a3caca969fb88992a412be3" id="r_a427a709f9a3caca969fb88992a412be3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a427a709f9a3caca969fb88992a412be3">t_cose_sign1_set_content_type_uint</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, uint16_t content_type)</td></tr>
<tr class="memdesc:a427a709f9a3caca969fb88992a412be3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the payload content type using CoAP content types.  <br /></td></tr>
<tr class="separator:a427a709f9a3caca969fb88992a412be3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92ea915477a67077690dea34687e8565" id="r_a92ea915477a67077690dea34687e8565"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a92ea915477a67077690dea34687e8565">t_cose_sign1_set_content_type_tstr</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, const char *content_type)</td></tr>
<tr class="memdesc:a92ea915477a67077690dea34687e8565"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the payload content type using MIME content types.  <br /></td></tr>
<tr class="separator:a92ea915477a67077690dea34687e8565"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47f0b98264e4cc35187180d1528b04ff" id="r_a47f0b98264e4cc35187180d1528b04ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a47f0b98264e4cc35187180d1528b04ff">t_cose_sign1_sign_set_auxiliary_buffer</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf auxiliary_buffer)</td></tr>
<tr class="memdesc:a47f0b98264e4cc35187180d1528b04ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure an auxiliary buffer used to serialize the Sig_Structure.  <br /></td></tr>
<tr class="separator:a47f0b98264e4cc35187180d1528b04ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa405275503e15528eae49bca821b647c" id="r_aa405275503e15528eae49bca821b647c"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#aa405275503e15528eae49bca821b647c">t_cose_sign1_sign_auxiliary_buffer_size</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context)</td></tr>
<tr class="memdesc:aa405275503e15528eae49bca821b647c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the required auxiliary buffer size for the most recent signing operation.  <br /></td></tr>
<tr class="separator:aa405275503e15528eae49bca821b647c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ef546f0592def62dc6046bad9dccc49" id="r_a0ef546f0592def62dc6046bad9dccc49"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49">t_cose_sign1_sign</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf_c payload, struct q_useful_buf out_buf, struct q_useful_buf_c *result)</td></tr>
<tr class="memdesc:a0ef546f0592def62dc6046bad9dccc49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and sign a <code>COSE_Sign1</code> message with a payload in one call.  <br /></td></tr>
<tr class="separator:a0ef546f0592def62dc6046bad9dccc49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72797308aca0342bd365da222e380b2" id="r_af72797308aca0342bd365da222e380b2"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#af72797308aca0342bd365da222e380b2">t_cose_sign1_sign_aad</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c payload, struct q_useful_buf out_buf, struct q_useful_buf_c *result)</td></tr>
<tr class="memdesc:af72797308aca0342bd365da222e380b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and sign a <code>COSE_Sign1</code> message with a payload in one call.  <br /></td></tr>
<tr class="separator:af72797308aca0342bd365da222e380b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e4ede2cfcc5fe94ef3ff192186cfba6" id="r_a8e4ede2cfcc5fe94ef3ff192186cfba6"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a8e4ede2cfcc5fe94ef3ff192186cfba6">t_cose_sign1_sign_detached</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c detached_payload, struct q_useful_buf out_buf, struct q_useful_buf_c *result)</td></tr>
<tr class="memdesc:a8e4ede2cfcc5fe94ef3ff192186cfba6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and sign a <code>COSE_Sign1</code> message with detached payload in one call.  <br /></td></tr>
<tr class="separator:a8e4ede2cfcc5fe94ef3ff192186cfba6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af73770fd0b41fe8e02b96c3bf1b1ff5b" id="r_af73770fd0b41fe8e02b96c3bf1b1ff5b"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b">t_cose_sign1_encode_parameters</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, QCBOREncodeContext *cbor_encode_ctx)</td></tr>
<tr class="memdesc:af73770fd0b41fe8e02b96c3bf1b1ff5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output first part and parameters for a <code>COSE_Sign1</code> message.  <br /></td></tr>
<tr class="separator:af73770fd0b41fe8e02b96c3bf1b1ff5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fb49347c0e17be027119524b4f87aee" id="r_a2fb49347c0e17be027119524b4f87aee"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee">t_cose_sign1_encode_signature</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, QCBOREncodeContext *cbor_encode_ctx)</td></tr>
<tr class="memdesc:a2fb49347c0e17be027119524b4f87aee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish a <code>COSE_Sign1</code> message by outputting the signature.  <br /></td></tr>
<tr class="separator:a2fb49347c0e17be027119524b4f87aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a36f1f5c33b2f0ca3c89f15e43591c6" id="r_a1a36f1f5c33b2f0ca3c89f15e43591c6"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a1a36f1f5c33b2f0ca3c89f15e43591c6">t_cose_sign1_encode_signature_aad</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf_c ext_sup_data, QCBOREncodeContext *cbor_encode_ctx)</td></tr>
<tr class="memdesc:a1a36f1f5c33b2f0ca3c89f15e43591c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish a <code>COSE_Sign1</code> message with externally supplied data by outputting the signature.  <br /></td></tr>
<tr class="separator:a1a36f1f5c33b2f0ca3c89f15e43591c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53f7c4ec6af3d4ecdeff8055fc16ae79" id="r_a53f7c4ec6af3d4ecdeff8055fc16ae79"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a53f7c4ec6af3d4ecdeff8055fc16ae79">t_cose_sign1_encode_parameters_private</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, bool payload_is_detached, QCBOREncodeContext *cbor_encode_ctx)</td></tr>
<tr class="memdesc:a53f7c4ec6af3d4ecdeff8055fc16ae79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semi-private function that ouputs the COSE parameters, startng a <code>COSE_Sign1</code> message.  <br /></td></tr>
<tr class="separator:a53f7c4ec6af3d4ecdeff8055fc16ae79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f90086e324f094f3588e1e5b786f515" id="r_a6f90086e324f094f3588e1e5b786f515"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#a6f90086e324f094f3588e1e5b786f515">t_cose_sign1_encode_signature_aad_private</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c detached_payload, QCBOREncodeContext *cbor_encode_ctx)</td></tr>
<tr class="memdesc:a6f90086e324f094f3588e1e5b786f515"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semi-private function that ouputs the signature, finishing a <code>COSE_Sign1</code> message.  <br /></td></tr>
<tr class="separator:a6f90086e324f094f3588e1e5b786f515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3299a1ee9f12f10f670bdec2e22ce72" id="r_aa3299a1ee9f12f10f670bdec2e22ce72"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__sign_8h.html#aa3299a1ee9f12f10f670bdec2e22ce72">t_cose_sign1_sign_aad_private</a> (struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *context, bool payload_is_detached, struct q_useful_buf_c ext_sup_data, struct q_useful_buf_c payload, struct q_useful_buf out_buf, struct q_useful_buf_c *result)</td></tr>
<tr class="memdesc:aa3299a1ee9f12f10f670bdec2e22ce72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semi-private function that does a complete signing in one call.  <br /></td></tr>
<tr class="separator:aa3299a1ee9f12f10f670bdec2e22ce72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Create a <code>COSE_Sign1</code> message, such as for EAT or CWT Token. </p>
<p>This creates a <code>COSE_Sign1</code> message in compliance with <a href="https://tools.ietf.org/html/rfc8152">COSE (RFC 8152)</a>. A <code>COSE_Sign1</code> message is a CBOR encoded binary blob that contains header parameters, a payload and a signature. Usually the signature is made with an EC signing algorithm like ECDSA.</p>
<p>This implementation is intended to be small and portable to different OS's and platforms. Its dependencies are:</p><ul>
<li><a href="https://github.com/laurencelundblade/QCBOR">QCBOR</a></li>
<li>&lt;stdint.h&gt;, &lt;string.h&gt;, &lt;stddef.h&gt;</li>
<li>Hash functions like SHA-256</li>
<li>Signing functions like ECDSA</li>
</ul>
<p>There is a cryptographic adaptation layer defined in t_cose_crypto.h. An implementation can be made of the functions in it for different cryptographic libraries. This means that different integrations with different cryptographic libraries may support only signing with a particular set of algorithms. Integration with <a href="https://www.openssl.org">OpenSSL</a> is supported. Key ID look up also varies by different cryptographic library integrations.</p>
<p>This implementation has a mode where a CBOR-format payload can be output directly into the output buffer. This saves having two copies of the payload in memory. For this mode use <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> and <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a>. For a simpler API that just takes the payload as an input buffer use <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a>.</p>
<p>See <a class="el" href="t__cose__common_8h.html" title="This file contains definitions common to all public t_cose interfaces.">t_cose_common.h</a> for preprocessor defines to reduce object code and stack use by disabling features. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af73770fd0b41fe8e02b96c3bf1b1ff5b" name="af73770fd0b41fe8e02b96c3bf1b1ff5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af73770fd0b41fe8e02b96c3bf1b1ff5b">&#9670;&#160;</a></span>t_cose_sign1_encode_parameters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_encode_parameters </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QCBOREncodeContext *&#160;</td>
          <td class="paramname"><em>cbor_encode_ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Output first part and parameters for a <code>COSE_Sign1</code> message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cbor_encode_ctx</td><td>Encoding context to output to.</td></tr>
  </table>
  </dd>
</dl>
<p>This is the more complex and more memory efficient alternative to <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a>. Like <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a>, <a class="el" href="t__cose__sign1__sign_8h.html#a8927bb39bae2bb95d3a94e034fb2b691" title="Initialize to start creating a COSE_Sign1.">t_cose_sign1_sign_init()</a> and <a class="el" href="t__cose__sign1__sign_8h.html#a6e155e4383f1f89551dffd23e2654b90" title="Set the key and kid (key ID) for signing.">t_cose_sign1_set_signing_key()</a> must be called before calling this.</p>
<p>When this is called, the opening parts of the <code>COSE_Sign1</code> message are output to the <code>cbor_encode_ctx</code>.</p>
<p>After this is called, the CBOR-formatted payload must be written to the <code>cbor_encode_ctx</code> by calling all the various <code>QCBOREncode_AddXxx</code> calls. It can be as simple or complex as needed.</p>
<p>To complete the <code>COSE_Sign1</code> call <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a>.</p>
<p>The <code>cbor_encode_ctx</code> must have been initialized with an output buffer to hold the <code>COSE_Sign1</code> header parameters, the payload and the signature.</p>
<p>This and <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a> can be used to calculate the size of the <code>COSE_Sign1</code> in the way <code>QCBOREncode</code> is usually used to calculate sizes. In this case the <code>t_cose_sign1_ctx</code> must be initialized with the options, algorithm, key and kid just as normal as these are needed to calculate the size. Then set up the output buffer for <code>cbor_encode_ctx</code> with a <code>NULL</code> pointer and large length like <code>UINT32_MAX</code>. Call <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a>, then format the payload into the encoder context, then call <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a>. Finally call <code>QCBOREncode_FinishGetSize()</code> to get the length. </p>

</div>
</div>
<a id="a53f7c4ec6af3d4ecdeff8055fc16ae79" name="a53f7c4ec6af3d4ecdeff8055fc16ae79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53f7c4ec6af3d4ecdeff8055fc16ae79">&#9670;&#160;</a></span>t_cose_sign1_encode_parameters_private()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_encode_parameters_private </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>payload_is_detached</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QCBOREncodeContext *&#160;</td>
          <td class="paramname"><em>cbor_encode_ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Semi-private function that ouputs the COSE parameters, startng a <code>COSE_Sign1</code> message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cbor_encode_ctx</td><td>Encoding context to output to.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This does the actual work for encoding the COSE parameters, but is a private function inside the implementation. Call <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> instead of this. </p>

</div>
</div>
<a id="a2fb49347c0e17be027119524b4f87aee" name="a2fb49347c0e17be027119524b4f87aee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fb49347c0e17be027119524b4f87aee">&#9670;&#160;</a></span>t_cose_sign1_encode_signature()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_encode_signature </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QCBOREncodeContext *&#160;</td>
          <td class="paramname"><em>cbor_encode_ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finish a <code>COSE_Sign1</code> message by outputting the signature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cbor_encode_ctx</td><td>Encoding context to output to.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>Call this to complete creation of a signed <code>COSE_Sign1</code> started with <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a>.</p>
<p>This is when the cryptographic signature algorithm is run.</p>
<p>The completed <code>COSE_Sign1</code> message is retrieved from the <code>cbor_encode_ctx</code> by calling <code>QCBOREncode_Finish()</code>. </p>

</div>
</div>
<a id="a1a36f1f5c33b2f0ca3c89f15e43591c6" name="a1a36f1f5c33b2f0ca3c89f15e43591c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a36f1f5c33b2f0ca3c89f15e43591c6">&#9670;&#160;</a></span>t_cose_sign1_encode_signature_aad()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_encode_signature_aad </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QCBOREncodeContext *&#160;</td>
          <td class="paramname"><em>cbor_encode_ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finish a <code>COSE_Sign1</code> message with externally supplied data by outputting the signature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cbor_encode_ctx</td><td>Encoding context to output to.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This is the same as <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a> and it allows passing in externally supplied data (formerly "AAD") to be covered by the signature.</p>
<p>Externally supplied data is simply any data that should also be covered by the signature. It is describe in RFC 9052, section 4.3. The verifier of the <code>COSE_Sign1</code> must also have exactly this data to be able to successfully verify the signature. Often this data is some parameters or fields in the protocol carrying the COSE message. </p>

</div>
</div>
<a id="a6f90086e324f094f3588e1e5b786f515" name="a6f90086e324f094f3588e1e5b786f515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f90086e324f094f3588e1e5b786f515">&#9670;&#160;</a></span>t_cose_sign1_encode_signature_aad_private()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_encode_signature_aad_private </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>detached_payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QCBOREncodeContext *&#160;</td>
          <td class="paramname"><em>cbor_encode_ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Semi-private function that ouputs the signature, finishing a <code>COSE_Sign1</code> message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detached_payload</td><td>The detached payload or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cbor_encode_ctx</td><td>Encoding context to output to.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This does the actual work for several public methods that output a signature. It is internal to the implmentation and <a class="el" href="t__cose__sign1__sign_8h.html#a1a36f1f5c33b2f0ca3c89f15e43591c6" title="Finish a COSE_Sign1 message with externally supplied data by outputting the signature.">t_cose_sign1_encode_signature_aad()</a> should be called instead.</p>
<p>If <code>detached_payload</code> is <code>NULL_Q_USEFUL_BUF_C</code> then the payload is to be inline and must have been added by calls to QCBOREncode after the call to <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a>. </p>

</div>
</div>
<a id="a92ea915477a67077690dea34687e8565" name="a92ea915477a67077690dea34687e8565"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92ea915477a67077690dea34687e8565">&#9670;&#160;</a></span>t_cose_sign1_set_content_type_tstr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_set_content_type_tstr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>content_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the payload content type using MIME content types. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">content_type</td><td>The content type of the payload as defined in the IANA Media Types registry.</td></tr>
  </table>
  </dd>
</dl>
<p>It is not allowed to have both a CoAP and MIME content type. This error will show up when <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a> or <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> is called.</p>
<p>The IANA Media Types registry can be found <a href="https://www.iana.org/assignments/media-types/media-types.xhtml">here</a>. These have been known as MIME types in the past. </p>

</div>
</div>
<a id="a427a709f9a3caca969fb88992a412be3" name="a427a709f9a3caca969fb88992a412be3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a427a709f9a3caca969fb88992a412be3">&#9670;&#160;</a></span>t_cose_sign1_set_content_type_uint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_set_content_type_uint </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>content_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the payload content type using CoAP content types. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">content_type</td><td>The content type of the payload as defined in the IANA CoAP Content-Formats registry.</td></tr>
  </table>
  </dd>
</dl>
<p>It is not allowed to have both a CoAP and MIME content type. This error will show up when <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a> or <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> is called as no error is returned by this function.</p>
<p>The IANA CoAP Content-Formats registry is found <a href="https://www.iana.org/assignments/core-parameters/core-parameters.xhtml#content-formats">here</a>. </p>

</div>
</div>
<a id="a6e155e4383f1f89551dffd23e2654b90" name="a6e155e4383f1f89551dffd23e2654b90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e155e4383f1f89551dffd23e2654b90">&#9670;&#160;</a></span>t_cose_sign1_set_signing_key()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_set_signing_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a>&#160;</td>
          <td class="paramname"><em>signing_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>kid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the key and kid (key ID) for signing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">signing_key</td><td>The signing key to use or an empty key. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kid</td><td>COSE kid (key ID) parameter or <code>NULL_Q_USEFUL_BUF_C</code>.</td></tr>
  </table>
  </dd>
</dl>
<p>This needs to be called to set the signing key to use. The <code>kid</code> may be omitted by giving <code>NULL_Q_USEFUL_BUF_C</code>.</p>
<p>If short-circuit signing is used, T_COSE_OPT_SHORT_CIRCUIT_SIG, then this does not need to be called. If it is called the <code>kid</code> given will be used, but the <code>signing_key</code> is never used. When the <code>kid</code> is given with a short-circuit signature, the internally fixed kid for short circuit will not be used and this <code>COSE_Sign1</code> message can not be verified by <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>. </p>

</div>
</div>
<a id="a0ef546f0592def62dc6046bad9dccc49" name="a0ef546f0592def62dc6046bad9dccc49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ef546f0592def62dc6046bad9dccc49">&#9670;&#160;</a></span>t_cose_sign1_sign()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_sign </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>out_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create and sign a <code>COSE_Sign1</code> message with a payload in one call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payload</td><td>Pointer and length of payload to sign. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_buf</td><td>Pointer and length of buffer to output to. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>Pointer and length of the resulting <code>COSE_Sign1</code>.</td></tr>
  </table>
  </dd>
</dl>
<p>The <code>context</code> must have been initialized with <a class="el" href="t__cose__sign1__sign_8h.html#a8927bb39bae2bb95d3a94e034fb2b691" title="Initialize to start creating a COSE_Sign1.">t_cose_sign1_sign_init()</a> and the key set with <a class="el" href="t__cose__sign1__sign_8h.html#a6e155e4383f1f89551dffd23e2654b90" title="Set the key and kid (key ID) for signing.">t_cose_sign1_set_signing_key()</a> before this is called.</p>
<p>This creates the COSE header parameter, hashes and signs the payload and creates the signature all in one go. <code>out_buf</code> gives the pointer and length of the memory into which the output is written. The pointer and length of the completed <code>COSE_Sign1</code> is returned in <code>result</code>. (<code>out_buf</code> and <code>result</code> are used instead of the usual in/out parameter for length because it is the convention for q_useful_buf and is more const correct.)</p>
<p>The size of <code>out_buf</code> must be the size of the payload plus overhead for formating, the signature and the key id (if used). The formatting overhead is minimal at about 30 bytes.The total overhead is about 150 bytes for ECDSA 256 with a 32-byte key ID.</p>
<p>To compute the size of the buffer needed before it is allocated call this with <code>out_buf</code> containing a <code>NULL</code> pointer and large length like <code>UINT32_MAX</code>. The algorithm and key, kid and such must be set up just as if the real <code>COSE_Sign1</code> were to be created as these values are needed to compute the size correctly. The contents of <code>result</code> will be a <code>NULL</code> pointer and the length of the <code>COSE_Sign1</code>. When this is run like this, the cryptographic functions will not actually run, but the size of their output will be taken into account to give an exact size.</p>
<p>This function requires the payload be complete and formatted in a contiguous buffer. The resulting <code>COSE_Sign1</code> message also contains the payload preceded by the header parameters and followed by the signature, all CBOR formatted. This function thus requires two copies of the payload to be in memory. Alternatively <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> and <a class="el" href="t__cose__sign1__sign_8h.html#a2fb49347c0e17be027119524b4f87aee" title="Finish a COSE_Sign1 message by outputting the signature.">t_cose_sign1_encode_signature()</a> can be used. They are more complex to use, but avoid the two copies of the payload and can reduce memory requirements by close to half.</p>
<p>See also <a class="el" href="t__cose__sign1__sign_8h.html#af72797308aca0342bd365da222e380b2" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign_aad()</a> and <a class="el" href="t__cose__sign1__sign_8h.html#a8e4ede2cfcc5fe94ef3ff192186cfba6" title="Create and sign a COSE_Sign1 message with detached payload in one call.">t_cose_sign1_sign_detached()</a>. </p>

</div>
</div>
<a id="af72797308aca0342bd365da222e380b2" name="af72797308aca0342bd365da222e380b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af72797308aca0342bd365da222e380b2">&#9670;&#160;</a></span>t_cose_sign1_sign_aad()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_sign_aad </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>out_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create and sign a <code>COSE_Sign1</code> message with a payload in one call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payload</td><td>Pointer and length of payload to sign. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_buf</td><td>Pointer and length of buffer to output to. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>Pointer and length of the resulting <code>COSE_Sign1</code>.</td></tr>
  </table>
  </dd>
</dl>
<p>This is the same as <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a> additionally allowing externally supplied data. Externally supplied data (formerly "AAD") is extra bytes to be authenticated by the signature. See <a class="el" href="t__cose__sign1__sign_8h.html#a1a36f1f5c33b2f0ca3c89f15e43591c6" title="Finish a COSE_Sign1 message with externally supplied data by outputting the signature.">t_cose_sign1_encode_signature_aad()</a> for more details.</p>
<p>Calling this with <code>ext_sup_data</code> as <code>NULL_Q_USEFUL_BUF_C</code> is equivalent to <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a>.</p>
<p>See also <a class="el" href="t__cose__sign1__sign_8h.html#a8e4ede2cfcc5fe94ef3ff192186cfba6" title="Create and sign a COSE_Sign1 message with detached payload in one call.">t_cose_sign1_sign_detached()</a>. </p>

</div>
</div>
<a id="aa3299a1ee9f12f10f670bdec2e22ce72" name="aa3299a1ee9f12f10f670bdec2e22ce72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3299a1ee9f12f10f670bdec2e22ce72">&#9670;&#160;</a></span>t_cose_sign1_sign_aad_private()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_sign_aad_private </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>payload_is_detached</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>out_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Semi-private function that does a complete signing in one call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payload_is_detached</td><td>If <code>true</code>, then <code>payload</code> is detached. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payload</td><td>The payload, inline or detached. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_buf</td><td>Pointer and length of buffer to output to. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>Pointer and length of the resulting <code>COSE_Sign1</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This is where the work actually gets done for signing that is done all in one call with or without externally supplied data and for included or detached payloads.</p>
<p>This is a private function internal to the implementation. Call <a class="el" href="t__cose__sign1__sign_8h.html#af72797308aca0342bd365da222e380b2" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign_aad()</a> instead of this. </p>

</div>
</div>
<a id="aa405275503e15528eae49bca821b647c" name="aa405275503e15528eae49bca821b647c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa405275503e15528eae49bca821b647c">&#9670;&#160;</a></span>t_cose_sign1_sign_auxiliary_buffer_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t t_cose_sign1_sign_auxiliary_buffer_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the required auxiliary buffer size for the most recent signing operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes of auxiliary buffer used by the most recent signing operation.</dd></dl>
<p>This function can be called after <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49">t_cose_sign1_sign</a> (or equivalent) was called. If a NULL output buffer was passed to the signing function (to operate in size calculation mode), this returns the number of bytes that would have been used by the signing operation. This allows the caller to allocate an appropriately sized buffer before performing the actual verification.</p>
<p>This function returns if the signature algorithm used does not need an auxiliary buffer. </p>

</div>
</div>
<a id="a8e4ede2cfcc5fe94ef3ff192186cfba6" name="a8e4ede2cfcc5fe94ef3ff192186cfba6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e4ede2cfcc5fe94ef3ff192186cfba6">&#9670;&#160;</a></span>t_cose_sign1_sign_detached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_sign_detached </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>ext_sup_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>detached_payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>out_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create and sign a <code>COSE_Sign1</code> message with detached payload in one call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ext_sup_data</td><td>Externally supplied data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detached_payload</td><td>Pointer and length of the detached payload to sign. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_buf</td><td>Pointer and length of buffer to output to. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result</td><td>Pointer and length of the resulting <code>COSE_Sign1</code>.</td></tr>
  </table>
  </dd>
</dl>
<p>This is similar to, but not the same as <a class="el" href="t__cose__sign1__sign_8h.html#af72797308aca0342bd365da222e380b2" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign_aad()</a>. Here the payload is detached, not inside the <code>COSE_Sign1</code> and conveyed separately. The signature is still over the payload as with <a class="el" href="t__cose__sign1__sign_8h.html#af72797308aca0342bd365da222e380b2" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign_aad()</a>. They payload must conveyed to recipient by some other means than by being inside the <code>COSE_Sign1</code>. The recipient will be unable to verify the <code>COSE_Sign1</code> without it.</p>
<p>This may be called with <code>ext_sup_data</code> as <code>NULL_Q_USEFUL_BUF_C</code> if there is no externally supplied data. </p>

</div>
</div>
<a id="a8927bb39bae2bb95d3a94e034fb2b691" name="a8927bb39bae2bb95d3a94e034fb2b691"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8927bb39bae2bb95d3a94e034fb2b691">&#9670;&#160;</a></span>t_cose_sign1_sign_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_sign_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>option_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>cose_algorithm_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize to start creating a <code>COSE_Sign1</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">option_flags</td><td>One of <code>T_COSE_OPT_XXXX</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_algorithm_id</td><td>The algorithm to sign with, for example <a class="el" href="t__cose__standard__constants_8h.html#ae11a8d65947b591d0861a7858dc256f9">T_COSE_ALGORITHM_ES256</a>.</td></tr>
  </table>
  </dd>
</dl>
<p>Initialize the <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> context. Typically, no <code>option_flags</code> are needed and 0 can be passed. A <code>cose_algorithm_id</code> must always be given. See T_COSE_OPT_SHORT_CIRCUIT_SIG and related for possible option flags.</p>
<p>The algorithm ID space is from <a href="https://tools.ietf.org/html/rfc8152">COSE (RFC8152)</a> and the <a href="https://www.iana.org/assignments/cose/cose.xhtml">IANA COSE Registry</a>. <a class="el" href="t__cose__standard__constants_8h.html#ae11a8d65947b591d0861a7858dc256f9">T_COSE_ALGORITHM_ES256</a> and a few others are defined here for convenience. The signing algorithms supported depends on the cryptographic library that t_cose is integrated with.</p>
<p>Errors such as the passing of an unsupported <code>cose_algorithm_id</code> are reported when <a class="el" href="t__cose__sign1__sign_8h.html#a0ef546f0592def62dc6046bad9dccc49" title="Create and sign a COSE_Sign1 message with a payload in one call.">t_cose_sign1_sign()</a> or <a class="el" href="t__cose__sign1__sign_8h.html#af73770fd0b41fe8e02b96c3bf1b1ff5b" title="Output first part and parameters for a COSE_Sign1 message.">t_cose_sign1_encode_parameters()</a> is called. </p>

</div>
</div>
<a id="a47f0b98264e4cc35187180d1528b04ff" name="a47f0b98264e4cc35187180d1528b04ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47f0b98264e4cc35187180d1528b04ff">&#9670;&#160;</a></span>t_cose_sign1_sign_set_auxiliary_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void t_cose_sign1_sign_set_auxiliary_buffer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__sign__ctx.html">t_cose_sign1_sign_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>auxiliary_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure an auxiliary buffer used to serialize the Sig_Structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signing context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">auxiliary_buffer</td><td>The buffer used to serialize the Sig_Structure.</td></tr>
  </table>
  </dd>
</dl>
<p>Some signature algorithms (namely EdDSA), require two passes over their input. In order to achieve this, the library needs to serialize a temporary to-be-signed structure into an auxiliary buffer. This function allows the user to configure such a buffer.</p>
<p>The buffer must be big enough to accomodate the Sig_Structure type, which is roughly the sum of sizes of the encoded protected parameters, externally supplied data and payload, along with a few dozen bytes of overhead.</p>
<p>To compute the exact size needed, an auxiliary buffer with a NULL pointer and a large size, such as <code>UINT32_MAX</code>, can be used. No actual signing will take place, but the auxiliary buffer will be shrunk to the to expected size. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
